{"id":"read_posts","script":"//* TITLE Read Posts **//\r\n//* VERSION 0.2.1 **//\r\n//* DESCRIPTION Dim old posts **//\r\n//* DETAILS Dims the posts on the dashboard that you've already seen on previous page loads. **//\r\n//* DEVELOPER bit-shift **//\r\n//* FRAME false **//\r\n//* BETA true **//\r\n\r\nXKit.extensions.read_posts = new Object({\r\n\r\n\trunning: false,\r\n\r\n\tpreferences: {\r\n\t\t\"dim_avatars_only\": {\r\n\t\t\ttext: \"Dim only the avatars on read posts.\",\r\n\t\t\tdefault: false,\r\n\t\t\tvalue: false\r\n\t\t}\r\n\t},\r\n\r\n\tundimmed_post: null,\r\n\tcurrently_undimming: false,\r\n\r\n\trun: function() {\r\n\t\tXKit.tools.init_css('read_posts');\r\n\t\tXKit.post_listener.add('read_posts_process', this.process_posts);\r\n\t\tthis.process_posts();\r\n\t\t$(document).on(\"click\",\".post_notes_inner *, .post_control.reply, .tumblelog_menu_button, .share_social_button, .post_control_menu\", XKit.extensions.read_posts.undim);\r\n\t\t$(document).on(\"click\", XKit.extensions.read_posts.redim);\r\n\r\n\t\tthis.running = true;\r\n\t},\r\n\r\n\tredim: function(e) {\r\n\t\t// This is less broken and meh.\r\n\t\tif (!XKit.extensions.read_posts.undimmed_post || XKit.extensions.read_posts.currently_undimming) {\r\n\t\t   //we don't currently have a post that needs redimming\r\n\t\t   XKit.extensions.read_posts.currently_undimming = false;\r\n\t\t   return;\r\n\t\t}\r\n\t\tvar m_obj = $(XKit.extensions.read_posts.undimmed_post)[0];\r\n\t\t$(m_obj).addClass(\"read_posts_read\");\r\n\t\tif (XKit.extensions.read_posts.preferences.dim_avatars_only.value === true) {\r\n\t\t\t$(m_obj).addClass('read_posts_avatar_only');\r\n\t\t}\r\n\t\tXKit.extensions.read_posts.undimmed_post = null;\r\n\t\tXKit.extensions.read_posts.currently_undimming = false;\r\n\t},\r\n\r\n\tundim: function(e) {\r\n\t\tXKit.extensions.read_posts.currently_undimming = true;\r\n\t\tvar m_obj = $(e.target)[0];\r\n\t\tif (!$(m_obj).hasClass(\"post\")) {\r\n\t\t\tm_obj = $(m_obj).parentsUntil('.post').parent();\r\n\t\t}\r\n\t\tif (!m_obj.hasClass(\"read_posts_read\")) {\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tXKit.extensions.read_posts.undimmed_post = m_obj;\r\n\t\t\t$(m_obj).removeClass(\"read_posts_read\");\r\n\t\t\t$(m_obj).removeClass('read_posts_avatar_only');\r\n\t\t}\r\n\t},\r\n\r\n\tmark_post_read: function(post_id) {\r\n\t\tvar read_posts = JSON.parse(XKit.storage.get('read_posts', 'read_posts', '[]'));\r\n\r\n\t\tif(XKit.storage.quota('read_posts') <= (post_id.length + 50)) {\r\n\t\t\t/* drop oldest ~33.3% of posts to make room for new */\r\n\t\t\tread_posts = read_posts.slice(Math.round(read_posts.length / 2));\r\n\t\t}\r\n\r\n\t\tread_posts.push(post_id);\r\n\t\tXKit.storage.set('read_posts', 'read_posts', JSON.stringify(read_posts));\r\n\t},\r\n\r\n\tpost_is_read: function(post_id) {\r\n\t\tvar read_posts = JSON.parse(XKit.storage.get('read_posts', 'read_posts', '[]'));\r\n\t\tif (read_posts.indexOf(post_id) > -1) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t},\r\n\r\n\tprocess_posts: function() {\r\n\t\tif (!XKit.interface.where().dashboard) {\r\n\t\t\treturn;  /* don't run on non-dashboard, since that can be in the background of a new post page */\r\n\t\t}\r\n\r\n\t\t$('.post.with_permalink').not('.read_posts_done').not(\".xkit_view_on_dash_post\").each(function(index) {\r\n\t\t\tvar post_id = $(this).attr('id').replace('post_', '');\r\n\r\n\t\t\tif (XKit.extensions.read_posts.post_is_read(post_id)) {\r\n\t\t\t\t$(this).addClass('read_posts_read');\r\n\t\t\t\tif (XKit.extensions.read_posts.preferences.dim_avatars_only.value === true) {\r\n\t\t\t\t\t$(this).addClass('read_posts_avatar_only');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tXKit.extensions.read_posts.mark_post_read(post_id);\r\n\t\t\t}\r\n\r\n\t\t\t$(this).addClass('read_posts_done');\r\n\t\t});\r\n\t},\r\n\r\n\tremove_classes: function() {\r\n\t\t$('.post.read_posts_done').removeClass('read_posts_done');\r\n\t\t$('.post.read_posts_read').removeClass('read_posts_read');\r\n\t\t$('.post.read_posts_avatar_only').removeClass('read_posts_avatar_only');\r\n\t},\r\n\r\n\tdestroy: function() {\r\n\t\tthis.remove_classes();\r\n\t\tXKit.tools.remove_css('read_posts');\r\n\t\tXKit.post_listener.remove('read_posts_process');\r\n\t\t$(\"document\").off(\"click\",\".post.read_posts_read .post_control.reply\", XKit.extensions.read_posts.undim);\r\n\t\tthis.running = false;\r\n\t}\r\n\r\n});\r\n","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OTlBRjlCQkZFRUU0MTFFMjlDQzREN0VDNzIxQUU5MkIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OTlBRjlCQzBFRUU0MTFFMjlDQzREN0VDNzIxQUU5MkIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5OUFGOUJCREVFRTQxMUUyOUNDNEQ3RUM3MjFBRTkyQiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5OUFGOUJCRUVFRTQxMUUyOUNDNEQ3RUM3MjFBRTkyQiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pg6tMywAAASvSURBVHjarFbPa11VEJ5z7q1gW/oiQqEuTMCqiIJBXChdJIjgwk0WdZ+dKyH4DyRZ6TLxDyhxKSgJiCguTIIiCCJxIRSibSxawdULiKjvnhm/b+a8xyO9CUI8ae87P+bMfPPjzEx659bHKYkVs2SqYvhTrrBQk4KPaSlqyu2uiFjXabKudNZxsxQQa4cr/r9gD1uCS05vrQhuJnyw4exBQSHgjI2Eff4K94RLguAOIEj9OJy4KFKCCScgF2nVwUIA1+YX+ZGUEq/hIgXiF+jUT5ODCVVDdh1GjKkQgjoiGqQVGoG3nInf4ITIY0VIxTkblfWpOHIdy+CMepAprcHrkrRQSlucnegYul9WDbGuQodLdENAEA3TkC95lhBEnQHGMVBreCWYtS7dbQSh4QN36PiHzofuOGMQuNxOKxg3EMSUwGKSCVtperc32bU0mViFBaiMHR2DMrdIWEs7d204QihGqsnc/sSuHnQZ7BIvcVtpInH1IOSxq4Mb8089OrgcQWNWg0em5nVSjR1xFASc3P99+OlX3/5weM8DMExEWzD8rl0dvHnz1abJco7xxOPXbrzw9Nvv3jq8+xtdJ5ZD/1FXXnru+jm5x8g5v/HaywgKTfR36+EhXTd65MrFM67t7+9vbGwMh0PMZ2ZmVlZWFhYWTiO+cukinJOl4UNjjlAI6NSsl/r4+Hh5eXlnZ2d6E8ulpaWtra3BYNB3SRkNmmGcbJ49Im56uS8uLp7gPpGBIxA8eBSPNd57RmwhJzG++iQA5sHBAb6Yz83NTR9BrclRj4yCMOJfRlZk8is9Gqyvr+/t7c3Pz8MUWGI+zW5tbQ1H2ARZnxIamSQXDg8l6fcBXApDwxrgCN/GJpazs7M4Os3PnqDxOhGmTDyQ0KPB6uoqGAVGWPzo6AjL4I5l6Ic5yE5y95E8ZbRdxyRTRv0+CE8CO+a7u7uT/c3NzTBRr/8jjNSzSxt5r6TSayEYBzDhT7CDJ8IHoc2ZYSp5XJ/gZCRk479TfAAW29vb4e0DH+FbbJ7GnYXNygjG8YeGTJQj950xFnz894SBd5Aa6tDS0yy0o8lD/vCTL05Q33z9lV4uE0oQxLxSWgLgBjUEPsAjQ/1Fu4BsIf/T+GfURc3JqAdRBVGIDu/ef/6Z62fgfXBMU07Pb//0M4ojKyBSBdqajlrYB599+ePRL+eHf+fer+9/9LkXOBQ3ti2eNbL9+dffb62/9+KzTw4uXxJvY8blzGpgCwtImlQvi8ZpTORjePzH19/d1nyhaS+YNwEtmxk2LTnLQyWlb76/E7We3FRqr6HJH3rydqSU0USIJ4Sg8gKZUm7IvbVo0gwFR6PMKn3SNrl5WGrDyHSV2RehrbAmOaOo6tnbj5AXXZS3DqBLwFl3a+C3tVWMfgZSMvg2iVhSasyvKbOK5jgGgfdpmZiU2T5z1ZjjmFiTM+8N2+lMSrsXb0eT35faq6FFcRfIpM3wYqI21t2bIK1ZyJXxvoiTlvyxRCeTXbdwgHQVDh5kbEenaTkFQ6mYrD5bBkwJI7j7c+RStC21ySKDpJHBk3fC1XcW7GAmKpUULXBybxr30qQvqi3oZKlVoX8FGAB4yKy0qIHfjAAAAABJRU5ErkJggg==","css":".read_posts_read:not(.read_posts_avatar_only) {\r\n\topacity: 0.4;\r\n\ttransition: opacity 0.3s ease-in-out;\r\n}\r\n\r\n.read_posts_read.read_posts_avatar_only .post_avatar {\r\n\topacity: 0.4;\r\n\ttransition: opacity 0.3s ease-in-out;\r\n}\r\n\r\n.read_posts_read:hover {\r\n\topacity: 1.0;\r\n}\r\n\r\n.read_posts_read:hover .post_avatar {\r\n\topacity: 1.0;\r\n}","title":"Read Posts","description":"Dim old posts","developer":"bit-shift","version":"0.2.1","frame":"false","beta":"true","details":"Dims the posts on the dashboard that you've already seen on previous page loads.","file":"found","server":"up","errors":false,"slow":"false"}