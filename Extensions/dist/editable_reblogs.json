{"id":"editable_reblogs","script":"//* TITLE Editable Reblogs **//\r\n//* VERSION 2.0.0 **//\r\n//* DESCRIPTION\tRestores ability to edit previous reblogs of a post **//\r\n//* DEVELOPER dlmarquis **//\r\n//* FRAME false **//\r\n//* BETA false **//\r\n\r\nXKit.extensions.editable_reblogs = new Object({\r\n\r\n\trunning: false,\r\n\r\n\trun: function() {\r\n\t\tthis.running = true;\r\n\r\n\t\tXKit.interface.post_window_listener.add(\"editable_reblogs\", XKit.extensions.editable_reblogs.post_window);\r\n\t\tXKit.tools.add_css(\".control-reblog-tree {display: none; }\", \"editable_reblogs_remove_content_tree\");\r\n\t},\r\n\r\n\tpost_window: function() {\r\n\t\tvar is_legacy = $(\".reblog-tree\").length > 0;\r\n\t\tif (is_legacy) {\r\n\t\t\tXKit.extensions.editable_reblogs.post_window_legacy();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar reblog_tree = $(\".post-form .reblog-list\");\r\n\t\tif (reblog_tree.length <= 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar all_quotes = [];\r\n\t\t// Guard against double evaluation by marking the tree as processed\r\n\t\tvar processed_class = 'xkit-editable-reblogs-done';\r\n\t\tif (reblog_tree.hasClass(processed_class)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treblog_tree.addClass(processed_class);\r\n\r\n\t\treblog_tree.find( \".reblog-list-item\" ).each(function( index ) {\r\n\t\t\tvar reblog_data = {\r\n\t\t\t\treblog_content: $(this).find('.reblog-content').html(),\r\n\t\t\t\treblog_author: $(this).find('.reblog-tumblelog-name').text(),\r\n\t\t\t\treblog_url: $(this).find('.reblog-tumblelog-name').attr('href')\r\n\t\t\t};\r\n\t\t\tall_quotes.push(reblog_data);\r\n\t\t});\r\n\t\tvar all_quotes_text = \"\";\r\n\t\tall_quotes.forEach(function(data, index, all) {\r\n\t\t\t//don't wrap if the previous user didn't add a comment\r\n\t\t\tif (data.reblog_content.indexOf(\"</blockquote>\", data.reblog_content.length - 13) !== -1) {\r\n\t\t\t\tall_quotes_text = data.reblog_content;\r\n\t\t\t} else {\r\n\t\t\t\tall_quotes_text = \"<p><a class='tumblr_blog' href='\" + data.reblog_url + \"'>\" + data.reblog_author + \"</a>:</p><blockquote>\" + all_quotes_text + data.reblog_content + \"</blockquote>\";\r\n\t\t\t}\t\t\r\n\t\t});\r\n\t\tvar old_content = XKit.interface.post_window.get_content_html();\r\n\t\tXKit.interface.post_window.set_content_html(all_quotes_text + old_content);\r\n\r\n\t\t$(\".btn-remove-trail .icon\").click();\r\n\t},\r\n\tpost_window_legacy: function() {\r\n\t\tvar reblog_tree = $(\".reblog-tree\");\r\n\t\tif (reblog_tree.length <= 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Guard against double evaluation by marking the tree as processed\r\n\t\tvar processed_class = 'xkit-editable-reblogs-done';\r\n\t\tif (reblog_tree.hasClass(processed_class)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treblog_tree.addClass(processed_class);\r\n\r\n\t\t// Convert all of the user links to have class tumblr_blog\r\n\t\tvar top_quote_link = reblog_tree.find('p:first-child > a:first-child');\r\n\t\tvar quote_links = reblog_tree.find('blockquote > p:first-child > a:first-child');\r\n\r\n\t\tif (top_quote_link.length > 0) {\r\n\t\t\t$(top_quote_link[0]).addClass('tumblr_blog');\r\n\t\t}\r\n\t\tquote_links.each(function() {\r\n\t\t\t$(this).addClass('tumblr_blog');\r\n\t\t});\r\n\r\n\t\tvar reblog_content = reblog_tree.html();\r\n\r\n\t\tvar old_content = XKit.interface.post_window.get_content_html();\r\n\t\tXKit.interface.post_window.set_content_html(reblog_content + old_content);\r\n\r\n\t\t$(\".btn-remove-tree\").click();\r\n\t},\r\n\tdestroy: function() {\r\n\t\tthis.running = false;\r\n\t\tXKit.tools.remove_css(\"editable_reblogs_remove_content_tree\");\r\n\t\tXKit.interface.post_window_listener.remove(\"editable_reblogs\");\r\n\t}\r\n});\r\n","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAA4VBMVEUAAAAAAQEBAgICBAQCBQYDBggEBwkHDRAHDhIIEBQIEBUJEhYKFhALFRoLFRsMGRUNGSAPIRgQHycYLzsYNScbNkMcNkQcN0UdOEYdOEceOkgfPUwfPU0gPk0gPk4gP08hQFAiQlMjTTgjTTkkTjktV20tWG4yYXoyYns4bIg7co9Bfp9Bj2lEhKZFhqdFh6lFh6pHiq1JjrJJj7NMlLpNlbtNlrtNlrxNl7pNl7tNmLpOmLlQpKpQpalRpqZRpqdRp6VSqaNSsoNTr5tTsJpTsZhTsZlUspdUsphWu4lWvIqrAtY3AAABFklEQVR42qXQa1OCQBiG4cdKOtn5bEmaZklaZi5v27kgi/3/PygY9l1g02Gm7m/wXMPsAippCpBlYCJLgGIxE6hPWQTfyooFA/W7txIQ+DZ4pCzeC4DyIJRkg/c80Ltodg14sf/ka7yfotLV4Inonmi0Pw9ua0DjPaBynoJ4/yI6gGn3Q7R6iWhoICeKqIqhuUbkLjmxaIgU+KGKAaD3BxV1Vr2Vhd5YpGfwA5UEKF3UrnnrQIuv+awYmL0f78n3p34hOqv1N3jXZwjyZ3AXvTXAFdcZIBlm4AZzy8l+u8kgFQZcAMlO22CQCgOOATQFPxpA5s3OyeWQaAbg/giqGOT2Kzg2qKNY3QajQwdZztEdg5L+D34AmZvHFbsM2NwAAAAASUVORK5CYII=\r\n","title":"Editable Reblogs","description":"Restores ability to edit previous reblogs of a post","developer":"dlmarquis","version":"2.0.0","frame":"false","beta":"false","file":"found","server":"up","errors":false,"slow":"false"}