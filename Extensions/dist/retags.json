{"id":"retags","script":"//* TITLE       Retags **//\r\n//* DEVELOPER   alexhong **//\r\n//* VERSION     0.6.9 **//\r\n//* DESCRIPTION Adds tags to reblog notes **//\r\n//* FRAME       false **//\r\n//* SLOW        false **//\r\n//* BETA        false **//\r\n\r\nXKit.extensions.retags = {\r\n\trunning: false,\r\n\tapi_key: '3DFxEZm0tGISOmdvWe9Fl1QsQMo1LFqEatnc8GQ68wgF1YTZ4w',\r\n\tselectors: '.reblog,.is_reblog,.notification_reblog,.is_reply,.is_answer',\r\n\tblog_name: \"\",\r\n\r\n\trun: function(){\r\n\t\tthis.running = true;\r\n\t\tXKit.tools.init_css(\"retags\");\r\n\t\ttry {\r\n\t\t\tthis.blog_name = $('body').data('new-root').split('/').pop();\r\n\t\t} catch(e) {}\r\n\t\tthis.add_toggle();\r\n\t\tthis.observer.observe($('body')[0],{childList:true,subtree:true});\r\n\t\tthis.tag(this.selectors);\r\n\t},\r\n\r\n\tobserver: new MutationObserver(function(ms){\r\n\t\tms.forEach(function(m){\r\n\t\t\tXKit.extensions.retags.tag($(m.addedNodes).filter(XKit.extensions.retags.selectors));\r\n\t\t});\r\n\t}),\r\n\r\n\tadd_toggle: function(){\r\n\t\tvar toggle = 'retags_toggle_'+this.blog_name;\r\n\t\tthis.html_toggle.appendTo('.ui_notes_switcher .part-toggle');\r\n\t\t$('#retags-toggle').change(function(){\r\n\t\t\tif ($(this).prop('checked')) {\r\n\t\t\t\tlocalStorage.setItem(toggle,'true');\r\n\t\t\t\tXKit.extensions.retags.css_toggle.appendTo('head');\r\n\t\t\t} else {\r\n\t\t\t\tlocalStorage.setItem(toggle,'false');\r\n\t\t\t\tXKit.extensions.retags.css_toggle.detach();\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (localStorage.getItem(toggle) === 'true') {\r\n\t\t\t$('#retags-toggle').click();\r\n\t\t}\r\n\t},\r\n\r\n\ttag: function(el){\r\n\t\t$(el).each(function(){\r\n\t\t\tvar $t = $(this), cls, $c, url;\r\n\t\t\tif ($t.find('div.retags').length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t// popover\r\n\t\t\tif ($t.hasClass('note')) {\r\n\t\t\t\tcls = 'with_commentary';\r\n\t\t\t\t$c = $t;\r\n\t\t\t\turl = $c.find('.action').data('post-url');\r\n\t\t\t// Activity\r\n\t\t\t} else if ($t.hasClass('ui_note')) {\r\n\t\t\t\tif ($t.find('.part_response').length) {\r\n\t\t\t\t\t$t.addClass('is_response');\r\n\t\t\t\t}\r\n\t\t\t\tcls = 'is_retags';\r\n\t\t\t\t$c = $t.find('.stage');\r\n\t\t\t\turl = $c.find('.part_glass').attr('href');\r\n\t\t\t// dashboard\r\n\t\t\t} else if ($t.hasClass('notification')) {\r\n\t\t\t\t$c = $t.find('.notification_sentence');\r\n\t\t\t\turl = $c.find('.notification_target').attr('href');\r\n\t\t\t}\r\n\t\t\t//we don't need to put tags on a reply, but we also don't need to hide it\r\n\t\t\tif ($t.hasClass('is_reply') || $t.hasClass('is_answer')) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (url) {\r\n\t\t\t\turl = url.split('/');\r\n\t\t\t\tvar host = url[2], id = url[4], cache = 'retags_'+id;\r\n\t\t\t\tif (localStorage.getItem(cache) !== null) {\r\n\t\t\t\t\tXKit.extensions.retags.append($t,cls,$c,JSON.parse(localStorage.getItem(cache)));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tXKit.extensions.retags.request($t,cls,$c,cache,'https://api.tumblr.com/v2/blog/'+host+'/posts/info?id='+id+'&api_key='+XKit.extensions.retags.api_key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\trequest: function($t,cls,$c,cache,url) {\r\n\t\tGM_xmlhttpRequest({\r\n\t\t\tmethod: 'GET',\r\n\t\t\turl: url,\r\n\t\t\tonload: function(data){\r\n\t\t\t\tvar tags = JSON.parse(data.responseText).response.posts[0].tags;\r\n\t\t\t\tlocalStorage.setItem(cache,JSON.stringify(tags));\r\n\t\t\t\tXKit.extensions.retags.append($t,cls,$c,tags);\r\n\t\t\t},\r\n\t\t\tonerror: function(data){\r\n\t\t\t\tXKit.extensions.retags.append($t,cls,$c,'ERROR: '+data.status);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tappend: function($t,cls,$c,tags){\r\n\t\tif (tags.length) {\r\n\t\t\tvar $retags = $('<div class=\"retags\">');\r\n\t\t\tif (typeof tags === 'string') {\r\n\t\t\t\t$retags.append(tags).addClass('error');\r\n\t\t\t} else {\r\n\t\t\t\ttags.forEach(function(tag){\r\n\t\t\t\t\t$retags.append('<a href=\"//tumblr.com/tagged/'+tag.replace(/ /g,'-')+'\">#'+tag+'</a>');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t$t.addClass(cls);\r\n\t\t\t$c.append($retags);\r\n\t\t}\r\n\t},\r\n\r\n\tcss_toggle:\r\n\t$('<style class=\"retags\"> ' +\r\n\t\t'.ui_note { display: none; } ' +\r\n\t\t'.ui_note.is_retags, .ui_note.is_response, .ui_note.is_user_mention { display: block; } ' +\r\n\t'</style>'),\r\n\r\n\thtml_toggle:\r\n\t$('<label class=\"retags binary_switch\">'+\r\n\t\t'<input id=\"retags-toggle\" type=\"checkbox\">'+\r\n\t\t'<span class=\"binary_switch_track\"></span>'+\r\n\t\t'<span class=\"binary_switch_button\"></span>'+\r\n\t\t'<span class=\"binary_switch_label\">Show only retags / responses</span>'+\r\n\t'</label>'),\r\n\r\n\tdestroy: function(){\r\n\t\tthis.running = false;\r\n\t\tXKit.tools.remove_css(\"retags\");\r\n\t\tthis.css_toggle.detach();\r\n\t\tthis.html_toggle.detach();\r\n\t\tthis.observer.disconnect();\r\n\t\t$('.retags').remove();\r\n\t\t$('body').off('.retags');\r\n\t}\r\n};\r\n","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDA5QTFGNzNEOEYzMTFFM0ExRkJBMjU3NUY4MjNFRjciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MDA5QTFGNzREOEYzMTFFM0ExRkJBMjU3NUY4MjNFRjciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowMDlBMUY3MUQ4RjMxMUUzQTFGQkEyNTc1RjgyM0VGNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowMDlBMUY3MkQ4RjMxMUUzQTFGQkEyNTc1RjgyM0VGNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpAlVCQAAAVxSURBVHja7Fp7bFNVGP/d29LHxgZ7m73kpRKjqP9ojAmwIEYFQYn/zUQji8ZHopigxgQFQggiOBOYomhiovuDDCMxIWqMMZj4py+CL/Zoe1v2hjHZuq5bW8937+2aQe+95z7aroaTk5umPff7ft/7O+dUOONJoZiHG2JR4y92+MwCgoDrLlRYAdzFLkCxu5CA/2kM3BuEq8wiUel9SLsK7UKW0bPR/Dy8DejeXsxZqG4rmGq623JfyFgdyDodkGELbv4YWvSdmrmtA7Vb6Nn9bE5dyJVbE5MMzJeeWxh1YPwXBPZi8mcZ2VNY8RpcizlkeCSHMrgFbguM/4o/ttEH5ZWRzxA9hzu+5LPDZnr2vJiLblRE9nnNCO67es3k7xg+ze1Lm7GqA5rsrE4TFoiexbWLx75H7SZuGTZR3uh5qUAulHWlr8kcv5qHKR56dxTChWpasyyraDHNsuYhrGwvhAstewXRv8mR5kbjDpTfaUVtTAbmS70785tGXaW4vROj3+DSD/A1YOlai+iVUf0gPXtftR8DbtOMFd72B9ER0fd6MW8pqx+gZ98beclCOZUhsKs4LZCRQUDgzbzEQK5k2Eh5KbCnmDf1VffLvrTX7IZGRNY5/FVhZFj+FrQgZZ2aFgi3U+Kv2pB3GTakG0f7MRA6QCJWthRABsY3uN+JLBQ8QM/8y6BwVLjbrQOhdyjHVa43phUfxpWzmPgTi29VI9KuDAJCB50oZNJhWYZ1emv6P8fwifQm4Ttc/BpNL8PfZE+G9cRXOmStnZ4/pXdx6Uc93Q93zVsf7UHkQyd8aR2ad+oBE357zMQVk381vHXZf7p8hp4VG1G2hqSFTLV0DVbtdkCMoS8w2KnlQmZaidh5mtn3awqdGVTch1QckQ55F3oOPbvR2AZfoy0BfMuhhZMqgYMzOavGX8ML6jdsDxQ+bgv9lITwUU2Oeq2EfwVq2Dbcq/qD4Ugl4KlO5/IWIhw5Tu9OncfYT2QZK+jD6NuD5BS0cOoVsrrHUX6XrTwoeBA5JvtStxUBGPrAPiTj0AGpZwH7jaqnStVcfNQ8+ggC+5HQ1r2JdjqVxPQQUtNGt7JJOmmc86LJf+imQ6Ffutoc+lgEwbeRnDZWom47nf5pZgx9zJQxY8bl96D5GRl9N6QOJCaJiHsJKteaQX8BgYNIRMHT6nNVYiWFca2UWUb7EP6ABFZeSc3AXW4CffBQ5l2Ogy0BelMeE3+RFxmslKerhBAw9Ez3Ygn8K+lLFoWsQeJFfzite76pFwOKDlgHMdQlG4Gj5MXCkI4RAtFD9YtFTkxSbcI6PIN3+xFq5/J73krMflLQUxTehPhFzF42IDd9QTarGze0ouw2yoMKfZfPGL30noze5CGDXgyMfoupXrJDyS2ofwKhIxCucBGtfRRL71ZDQqWvCys2AOmInO/Nn/HobWimAsTYvwwNT0L0ITXL++cW9komj4nzElp29EdJ99YOeAyykK8JjU9TaDIGzK3FRVx5IQM3bQEtx5gepIhPWdK9sQW89aR75RZMWITG7dTtcKTSTC3LOI+QHT2LeMu6Nw7ipjY6mJgLaE+NaerKyYem7j+i6i7YOxrUs0B8BP5Se81QUtXuVZmRoWeNqk3dGwvQ30nJx3+j2g6xjE5xzHmSJ2L2X9rjK/QVIhn0nyARd+b/bnpBnJzBwAmSwVdP7cBAl9zbmPUimT6rIb4GGf0QIp8SZadOxQ3OhRIxWYZWeGspC1Fza21Tewqz47SfHjxF+d7BI3G3aKSJZBRDJ1G3jUqBOGGd01j6UEN09EaCa1PPlDdy2oGMkYvBe8GhbqkWoABCsf/tsuB3ZHlyoQVsgesuVNjxnwADACKdjtGZRJ7nAAAAAElFTkSuQmCC","css":".ui_notes .date_header .part_full_date.stuck {\r\n\tmargin-left: 400px;\r\n\twidth: 165px;\r\n}\r\n\r\nlabel.retags {\r\n\tmargin-left: 15px;\r\n\ttop: -1px;\r\n}\r\nlabel.retags .binary_switch_label {\r\n\tposition: absolute;\r\n\ttop: 0; left: 24px;\r\n\tpadding: 0 8px;\r\n\tline-height: 14px;\r\n\twhite-space: nowrap;\r\n}\r\n\r\ndiv.retags {\r\n\twhite-space: normal;\r\n\tmargin-top: 10px;\r\n}\r\n\r\ndiv.retags.error {\r\n\tcolor: #c00000;\r\n}\r\n\r\ndiv.retags + div.retags:before {\r\n\tcolor: #c00000;\r\n\tcontent: \"Warning: You are running multiple copies of Retags.\";\r\n}\r\n\r\ndiv.retags + div.retags a {\r\n\tdisplay: none;\r\n}\r\n\r\ndiv.retags a {\r\n\tcolor: #a7a7a7 !important;\r\n\tposition: relative;\r\n\tmargin-right: 11px;\r\n\ttext-decoration: none;\r\n}\r\n\r\ndiv.retags a:hover {\r\n\tcolor: #969696 !important;\r\n}\r\n\r\n.note div.retags {\r\n\tfont-size: 12px;\r\n\tline-height: 1.3;\r\n}\r\n\r\n.note div.retags a {\r\n\tmargin-right: 9px;\r\n}\r\n\r\n.post_notes .notes_outer_container.popover .note.with_commentary span.action {\r\n\tmin-height: 0;\r\n}\r\n\r\n.notification div.retags a {\r\n\tcolor: rgba(255,255,255,0.3) !important;\r\n}\r\n\r\n.notification div.retags a:hover {\r\n\tcolor: rgba(255,255,255,0.4) !important;\r\n}\r\n\r\n.ui_note div.retags {\r\n\tmargin-top: 0;\r\n\tpadding: 40px 50px 13px;\r\n}\r\n\r\n.ui_note div.retags + div.retags {\r\n\tmargin-top: -5px;\r\n\tpadding-top: 0;\r\n}\r\n\r\n.ui_note .part_response + div.retags {\r\n\tmargin-top: -7px;\r\n\tpadding-top: 0;\r\n}\r\n\r\ndiv.retags a:after {\r\n\tcontent: \"\\\\00a0  \";\r\n\tfont-size: 0;\r\n\tline-height: 0;\r\n}\r\n","title":"Retags","description":"Adds tags to reblog notes","developer":"alexhong","version":"0.6.9","frame":"false","beta":"false","slow":"false","file":"found","server":"up","errors":false}