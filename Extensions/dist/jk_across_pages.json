{"id":"jk_across_pages","script":"//* TITLE J/K Across Pages **//\r\n//* VERSION 1.1.2 **//\r\n//* DESCRIPTION Allow Tumblr's J/K navigation to move between pages **//\r\n//* DEVELOPER beiju **//\r\n//* FRAME false **//\r\n//* BETA true **//\r\n\r\nXKit.extensions.jk_across_pages = new Object({\r\n\t/*\r\n\t * If the top of the last post is this far below the top of the screen or less, j will move to the next page.\r\n\t */\r\n\tscrollBufferJ: 8,\r\n\t/*\r\n\t * If the top of first post is this far below the top of the screen or more, k will move to the previous page.\r\n\t */\r\n\tscrollBufferK: 7,\r\n\t/*\r\n\t * Leave this much overlap when using view_entire_posts\r\n\t */\r\n\tscrollBufferInside: 50,\r\n\t/*\r\n\t * This is the size of the gap between posts\r\n\t */\r\n\tpostBuffer: 20,\r\n\t/*\r\n\t * How long scroll animations should take (milliseconds)\r\n\t */\r\n\tscrollAnimationDuration: 100,\r\n\r\n\t$posts: false,\r\n\r\n\trunning: false,\r\n\r\n\r\n\tpreferences: {\r\n\t\t\"sep0\": {\r\n\t\t\ttype: 'separator',\r\n\t\t\ttext: \"Other\"\r\n\t\t},\r\n\t\t\"show_notifications\": {\r\n\t\t\ttext: \"Show notifications when moving between pages\",\r\n\t\t\t'default': true,\r\n\t\t\tvalue: true\r\n\t\t},\r\n\t\t\"view_entire_posts\": {\r\n\t\t\ttext: \"Scroll through the entire post, even if it's longer than the screen\",\r\n\t\t\t'default': false,\r\n\t\t\tvalue: false\r\n\t\t}\r\n\t},\r\n\r\n\trun: function() {\r\n\t\t//this.registerJQueryPlugins();\r\n\t\tthis.$posts = jQuery('.post_container').not('#new_post_buttons');\r\n\r\n\t\tXKit.tools.init_css(\"jk_across_pages\");\r\n\r\n\t\t// If #auto_pagination_loader exists, endless scrolling is enabled and this extension is useless\r\n\t\tif (jQuery('#auto_pagination_loader').length > 0) return;\r\n\r\n\t\tif (/jk_across_pages_first/i.test(window.location.hash)) {\r\n\t\t\tconsole.log(\"Scrolling to first post\", this.$posts.first());\r\n\t\t\tjQuery('html, body').animate({\r\n\t\t\t\tscrollTop: this.$posts.first().offset().top - this.scrollBufferJ\r\n\t\t\t}, this.scrollAnimationDuration);\r\n\t\t\twindow.location.hash = '';\r\n\t\t} else if (/jk_across_pages_last/i.test(window.location.hash)) {\r\n\t\t\tconsole.log(\"Scrolling to last post\", this.$posts.last());\r\n\t\t\tjQuery('html, body').animate({\r\n\t\t\t\tscrollTop: this.$posts.last().offset().top - this.scrollBufferK\r\n\t\t\t}, this.scrollAnimationDuration);\r\n\t\t\twindow.location.hash = '';\r\n\t\t}\r\n\r\n\t\tvar that = this;\r\n\t\tjQuery(document.body).bind('keydown.xkit_jk_across_pages', function(evt) {\r\n\t\t\tif (!evt.shiftKey && !evt.ctrlKey && !evt.altKey && !evt.metaKey) {\r\n\t\t\t\t// If the key wasn't J or K, we have nothing to do here.\r\n\t\t\t\tif (evt.which === 74 /* j */ && evt.which === 75 /* k */) return;\r\n\r\n\t\t\t\t// If the new post field has focus, do nothing.\r\n\t\t\t\tif (jQuery('.scrollverlay.active').length !== 0) return;\r\n\t\t\t\t// If XKit preferences are open, do nothing\r\n\t\t\t\tif (jQuery('#xkit-control-panel').length !== 0) return;\r\n\t\t\t\t// If the user is typing in an input, do nothing\r\n\t\t\t\tif (jQuery('input:focus').length !== 0) return;\r\n\r\n\t\t\t\tthat.$posts = jQuery('.post_container').not('#new_post_buttons');\r\n\r\n\t\t\t\tif (that.preferences.view_entire_posts.value && evt.which === 74 /* j */ &&\r\n\t\t\t\t\tthat.postAtY(that.scrollBufferJ+1)[0] == that.postAtY(window.innerHeight - that.scrollBufferJ)[0]){\r\n\r\n\t\t\t\t\tevt.stopPropagation(); // Try to stop Tumblr's event listener\r\n\r\n\t\t\t\t\t/* Animate this twice to make sure Tumblr's scrolling doesn't override it */\r\n\t\t\t\t\tvar scrollTo = window.scrollY + window.innerHeight - that.scrollBufferInside;\r\n\t\t\t\t\tjQuery(document.body).animate({ scrollTop: scrollTo }, that.scrollAnimationDuration, function() {\r\n\t\t\t\t\t\t$(this).animate({ scrollTop: scrollTo }, that.scrollAnimationDuration);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\treturn; // Don't try to go to the next page\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/* console.log('key code', evt.which,\r\n\t\t\t\t\t'bottom scroll', that.$posts.last().offset().top - window.scrollY,\r\n\t\t\t\t\t'(threshold', that.scrollBufferJ, ')',\r\n\t\t\t\t\t'top scroll', that.$posts.first().offset().top + that.$posts.first().height() - window.scrollY,\r\n\t\t\t\t\t'(threshold', that.scrollBufferK, ')'); */\r\n\r\n\t\t\t\tif (evt.which === 74 /* j */ && that.$posts.last().offset().top - window.scrollY <= that.scrollBufferJ) {\r\n\t\t\t\t\tif (jQuery('#next_page_link').length > 0) {\r\n\t\t\t\t\t\tif (that.preferences.show_notifications.value === true) XKit.notifications.add(\"Moving to next page\", \"ok\");\r\n\t\t\t\t\t\twindow.location = jQuery('#next_page_link').attr('href') + '#jk_across_pages_first';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (that.preferences.show_notifications.value === true) XKit.notifications.add(\"Already at last page\", \"warning\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (evt.which === 75 /* k */ && that.$posts.first().offset().top - window.scrollY >= that.scrollBufferK) {\r\n\t\t\t\t\tif (jQuery('#previous_page_link').length > 0) {\r\n\t\t\t\t\t\tif (that.preferences.show_notifications.value === true) XKit.notifications.add(\"Moving to previous page\", \"ok\");\r\n\t\t\t\t\t\twindow.location = jQuery('#previous_page_link').attr('href') + '#jk_across_pages_last';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (that.preferences.show_notifications.value === true) XKit.notifications.add(\"Already at first page\", \"warning\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.running = true;\r\n\t},\r\n\r\n\tpostAtY: function(y) {\r\n\t\tvar x = jQuery('#posts').offset().left + 1;\r\n\r\n\t\t/* console.log(\"postAtY parameter:\", y, \"element\", document.elementFromPoint(x, y)); */\r\n\r\n\t\treturn jQuery(document.elementFromPoint(x, y)).closest('.post_container');\r\n\t},\r\n\r\n\tdestroy: function() {\r\n\t\ttry {\r\n\t\t\tjQuery(document.body).unbind('.xkit_jk_across_pages');\r\n\t\t\tXKit.tools.remove_css(\"jk_across_pages\");\r\n\t\t\tthis.running = false;\r\n\t\t} catch(err) {\r\n\t\t\tif (console && console.error) console.error(e);\r\n\t\t}\r\n\t}\r\n\r\n});\r\n","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTU5RDUwRTFDRUE0MTFFMjlGRjNBNzgwQUUxNTkwRDkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QTU5RDUwRTJDRUE0MTFFMjlGRjNBNzgwQUUxNTkwRDkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBNTlENTBERkNFQTQxMUUyOUZGM0E3ODBBRTE1OTBEOSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBNTlENTBFMENFQTQxMUUyOUZGM0E3ODBBRTE1OTBEOSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Poz+E8EAAAOsSURBVHjapFbNSyRHFK+qrnZmR9dxVlYxCcqiCyrsZQMeBGFhCYHc9ri3XPJP5Lz/RU655JJDWJLLgqKLBxkQXBDFsISQIavLgitqnFGn6728quouq3uqm/14DENX1av3/X6v+LNffmCGFALnHDUBywhQ2Q/aNf9gv5FZRnSntAUqO0WeXgGUqSCG2Rn4EgtkRZedZjzcX0rl2VuQTgYMHgW1QuYKgKcbtD2yTLpPAKoo1FzO+Jl3kRc4JerQCzQ39FrIh/cf3R390rtonEnXOGiE/SQjdv9uv/531zdfC/Rt5yi+/+ZH0a+xT6J74w+2W2vrr37LioU5BWne5r94+NXde+wz6LvJpy93/kCeuB3hnFUKxm9PVd/vdDqnp6cVDDKSzca4jbdxAoWuVfujUsAq6RcXFxsbG6urq0mSVLBRmbqi0h54PYUMK67h2tra5eXl8fHx1tYWq9SgC1eB9sM1mg0U7Smlgre2t7ePjo7s9/7+/uTk5OzsbJAT8lZKV+a6XSCs4PDwcGdnx9/Z3NxstVrNZjPgAORaUvhNRH4lA3R2dra+vl6Q0u/3KRlXV1eD/GDjk1GukxUoulmQdX19vbKyQmra7bbbXF5eHh4e7na79Xq92gOZwY5OMcVnUMGQIUT0u7fRaIyNjVlXBnDF9DY6BTc4GlbgYuIr6BsqK6JiklMnACmCFJAyBeD5TssyztRX54GdEinqlntAun3TaFnG6WZULge2AxMVTjIls9fr+QpOTk5ov24o2Mk8M1rmIReCMLC3t0c4UdiJ43hpaWmQHxX67gh/YthGKxBZsbi4KITAPC0sLEgpA/wM/Z6WAOnsRgW6EUKdXKvV5ubmDg4O3M709PTo6GiQ2Q476EMG14AVU97RxMTE1FQK5oQQMzMzHzIeDFzfEKuGa0K3kZERarr5+XmaWWVsdADJzcvDJVkPud71fxUKKA0UdyoniljV2Oid6ymjm5nbMuUUfZoLHFnn3Z9q4ds7rTtll4Pw6YiG3Zt3/3SvzmqNmJnYUIIlGuSjdx0T/Lz7/vnmz4+/ftIcaX3CQH7d2X/R/jWSETcu2Lkmb0AMWVyTb8//+un3Z6qvjynOdrQWqgCLD5q0MGUc3WrEQzKmPEDWDdII4jY7kRT1BjEImhGYBy8YKDbuvbc03nAmIiG4JqUgDHY6kxEfiuL8Yy0g3SlQNsIsYqZMiFMV5oHrjo8Kd066Ea07VQXer7ICyiuCkyRZDxvpQdGW/hdgAP9if38Csi+wAAAAAElFTkSuQmCC","css":"/*\r\n * This allows the j key to scroll to the top of the last post,\r\n * no matter how tall it is compared to the user's screen\r\n */\r\n.l-footer-container {\r\n\theight: 100%;\r\n}","title":"J/K Across Pages","description":"Allow Tumblr's J/K navigation to move between pages","developer":"beiju","version":"1.1.2","frame":"false","beta":"true","file":"found","server":"up","errors":false,"slow":"false"}